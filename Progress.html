<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000; min-height: 16.0px}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #900112; -webkit-text-stroke: #900112}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0e6e6d; -webkit-text-stroke: #0e6e6d}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0000ff; -webkit-text-stroke: #0000ff}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0f7001; -webkit-text-stroke: #0f7001}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #900112; -webkit-text-stroke: #900112; min-height: 16.0px}
    span.s1 {font-kerning: none}
    span.s2 {font-kerning: none; color: #0000ff; background-color: #fffffe; -webkit-text-stroke: 0px #0000ff}
    span.s3 {font-kerning: none; background-color: #fffffe}
    span.s4 {font-kerning: none; color: #0e6e6d; background-color: #fffffe; -webkit-text-stroke: 0px #0e6e6d}
    span.s5 {font-kerning: none; color: #900112; background-color: #fffffe; -webkit-text-stroke: 0px #900112}
    span.s6 {font-kerning: none; color: #000000; background-color: #fffffe; -webkit-text-stroke: 0px #000000}
    span.s7 {font-kerning: none; color: #0f7001; background-color: #fffffe; -webkit-text-stroke: 0px #0f7001}
    span.s8 {font-kerning: none; color: #137646; background-color: #fffffe; -webkit-text-stroke: 0px #137646}
  </style>
</head>
<body>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s2">import</span><span class="s3"> </span><span class="s4">React</span><span class="s3">, { useState, useEffect, useCallback } </span><span class="s2">from</span><span class="s3"> </span><span class="s5">"react"</span><span class="s3">;</span></p>
<p class="p3"><span class="s2">import</span><span class="s6"> { motion } </span><span class="s2">from</span><span class="s6"> </span><span class="s3">"framer-motion"</span><span class="s6">;</span></p>
<p class="p4"><span class="s2">import</span><span class="s6"> { </span><span class="s3">Card</span><span class="s6">, </span><span class="s3">CardContent</span><span class="s6">, </span><span class="s3">CardHeader</span><span class="s6">, </span><span class="s3">CardTitle</span><span class="s6"> } </span><span class="s2">from</span><span class="s6"> </span><span class="s5">"@/components/ui/card"</span><span class="s6">;</span></p>
<p class="p3"><span class="s2">import</span><span class="s6"> { </span><span class="s4">Button</span><span class="s6"> } </span><span class="s2">from</span><span class="s6"> </span><span class="s3">"@/components/ui/button"</span><span class="s6">;</span></p>
<p class="p4"><span class="s2">import</span><span class="s6"> { </span><span class="s3">Tabs</span><span class="s6">, </span><span class="s3">TabsContent</span><span class="s6">, </span><span class="s3">TabsList</span><span class="s6">, </span><span class="s3">TabsTrigger</span><span class="s6"> } </span><span class="s2">from</span><span class="s6"> </span><span class="s5">"@/components/ui/tabs"</span><span class="s6">;</span></p>
<p class="p3"><span class="s2">import</span><span class="s6"> { </span><span class="s4">WritingEntry</span><span class="s6"> } </span><span class="s2">from</span><span class="s6"> </span><span class="s3">"@/entities/WritingEntry"</span><span class="s6">;</span></p>
<p class="p3"><span class="s2">import</span><span class="s6"> { </span><span class="s4">MoodEntry</span><span class="s6"> } </span><span class="s2">from</span><span class="s6"> </span><span class="s3">"@/entities/MoodEntry"</span><span class="s6">;</span></p>
<p class="p3"><span class="s2">import</span><span class="s6"> { </span><span class="s4">User</span><span class="s6"> } </span><span class="s2">from</span><span class="s6"> </span><span class="s3">"@/entities/User"</span><span class="s6">;</span></p>
<p class="p3"><span class="s2">import</span><span class="s6"> { </span><span class="s4">InvokeLLM</span><span class="s6"> } </span><span class="s2">from</span><span class="s6"> </span><span class="s3">"@/integrations/Core"</span><span class="s6">;</span></p>
<p class="p5"><span class="s3">import</span><span class="s6"> {<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">LineChart</span><span class="s6">,<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s4">Line</span><span class="s3">,<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">AreaChart</span><span class="s6">,<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s4">Area</span><span class="s3">,<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">BarChart</span><span class="s6">,<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s4">Bar</span><span class="s3">,</span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">PieChart</span><span class="s6">,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s4">Pie</span><span class="s3">,</span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">Cell</span><span class="s6">,</span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">XAxis</span><span class="s6">,<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">YAxis</span><span class="s6">,<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">CartesianGrid</span><span class="s6">,<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">Tooltip</span><span class="s6">,<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">ResponsiveContainer</span><span class="s6">,</span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">RadarChart</span><span class="s6">,</span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">PolarGrid</span><span class="s6">,</span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">PolarAngleAxis</span><span class="s6">,</span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">PolarRadiusAxis</span><span class="s6">,</span></p>
<p class="p4"><span class="s6"><span class="Apple-converted-space">  </span></span><span class="s3">Radar</span></p>
<p class="p3"><span class="s6">} </span><span class="s2">from</span><span class="s6"> </span><span class="s3">"recharts"</span><span class="s6">;</span></p>
<p class="p4"><span class="s2">import</span><span class="s6"> { </span><span class="s3">TrendingUp</span><span class="s6">, </span><span class="s3">Heart</span><span class="s6">, </span><span class="s3">PenTool</span><span class="s6">, </span><span class="s3">Calendar</span><span class="s6">, </span><span class="s3">Sparkles</span><span class="s6">, </span><span class="s3">Target</span><span class="s6">, </span><span class="s3">Award</span><span class="s6">, </span><span class="s3">Loader2</span><span class="s6"> } </span><span class="s2">from</span><span class="s6"> </span><span class="s5">"lucide-react"</span><span class="s6">;</span></p>
<p class="p2"><span class="s2">import</span><span class="s3"> { format, eachWeekOfInterval, startOfWeek, endOfWeek, subWeeks, isWithinInterval } </span><span class="s2">from</span><span class="s3"> </span><span class="s5">"date-fns"</span><span class="s3">;</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p5"><span class="s3">export</span><span class="s6"> </span><span class="s3">default</span><span class="s6"> </span><span class="s3">function</span><span class="s6"> </span><span class="s4">Progress</span><span class="s6">() {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> [user, setUser] = useState(</span><span class="s2">null</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> [entries, setEntries] = useState([]);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> [moodEntries, setMoodEntries] = useState([]);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> [progressData, setProgressData] = useState(</span><span class="s2">null</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> [isLoading, setIsLoading] = useState(</span><span class="s2">true</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> [timeRange, setTimeRange] = useState(</span><span class="s5">'3months'</span><span class="s3">); </span><span class="s7">// 1month, 3months, 6months, all</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> generateProgressAnalytics = useCallback(</span><span class="s2">async</span><span class="s3"> (entries, moods) =&gt; {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">if</span><span class="s3"> (entries.length === </span><span class="s8">0</span><span class="s3">) {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>setProgressData({</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>moodTrend: [],</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>writingFrequency: [],</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>emotionalThemes: [],</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>weeklyProgress: [],</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>overallStats: { avgMoodImprovement: </span><span class="s8">0</span><span class="s3">, totalWords: </span><span class="s8">0</span><span class="s3">, consistencyScore: </span><span class="s8">0</span><span class="s3"> }</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>});</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">return</span><span class="s3">;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">    </span></span><span class="s3">// Filter entries by time range</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> now = </span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">();</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> startDate = timeRange === </span><span class="s5">'1month'</span><span class="s3"> ? subWeeks(now, </span><span class="s8">4</span><span class="s3">) :</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                     </span>timeRange === </span><span class="s5">'3months'</span><span class="s3"> ? subWeeks(now, </span><span class="s8">12</span><span class="s3">) :</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                     </span>timeRange === </span><span class="s5">'6months'</span><span class="s3"> ? subWeeks(now, </span><span class="s8">24</span><span class="s3">) :</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                     </span></span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">(entries[entries.length - </span><span class="s8">1</span><span class="s3">].created_date);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> filteredEntries = entries.filter(entry =&gt;<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">(entry.created_date) &gt;= startDate</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">    </span></span><span class="s3">// Mood trend analysis</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> moodTrend = filteredEntries</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>.filter(entry =&gt; entry.mood_before &amp;&amp; entry.mood_after)</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>.map(entry =&gt; ({</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>date: format(</span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">(entry.created_date), </span><span class="s5">'MMM dd'</span><span class="s3">),</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>before: entry.mood_before,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>after: entry.mood_after,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>improvement: entry.mood_after - entry.mood_before,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>wordCount: entry.word_count || </span><span class="s8">0</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>}));</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">    </span></span><span class="s3">// Weekly writing frequency</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> weeks = eachWeekOfInterval({</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>start: startDate,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>end: now</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> weeklyProgress = weeks.map(weekStart =&gt; {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">const</span><span class="s3"> weekEnd = endOfWeek(weekStart);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">const</span><span class="s3"> weekEntries = filteredEntries.filter(entry =&gt;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>isWithinInterval(</span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">(entry.created_date), { start: weekStart, end: weekEnd })</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>);</span></p>
<p class="p1"><span class="s3"><span class="Apple-converted-space">      </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">const</span><span class="s3"> weekMoods = weekEntries.filter(e =&gt; e.mood_before &amp;&amp; e.mood_after);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">const</span><span class="s3"> avgImprovement = weekMoods.length &gt; </span><span class="s8">0</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>? weekMoods.reduce((sum, e) =&gt; sum + (e.mood_after - e.mood_before), </span><span class="s8">0</span><span class="s3">) / weekMoods.length</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>: </span><span class="s8">0</span><span class="s3">;</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">return</span><span class="s3"> {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>week: format(weekStart, </span><span class="s5">'MMM dd'</span><span class="s3">),</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>entries: weekEntries.length,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>words: weekEntries.reduce((sum, e) =&gt; sum + (e.word_count || </span><span class="s8">0</span><span class="s3">), </span><span class="s8">0</span><span class="s3">),</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>moodImprovement: avgImprovement,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>avgMoodBefore: weekMoods.length &gt; </span><span class="s8">0</span><span class="s3"> ? weekMoods.reduce((sum, e) =&gt; sum + e.mood_before, </span><span class="s8">0</span><span class="s3">) / weekMoods.length : </span><span class="s8">0</span><span class="s3">,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>avgMoodAfter: weekMoods.length &gt; </span><span class="s8">0</span><span class="s3"> ? weekMoods.reduce((sum, e) =&gt; sum + e.mood_after, </span><span class="s8">0</span><span class="s3">) / weekMoods.length : </span><span class="s8">0</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">    </span></span><span class="s3">// Emotional theme analysis using AI</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">let</span><span class="s3"> emotionalThemes = [];</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">if</span><span class="s3"> (filteredEntries.length &gt; </span><span class="s8">0</span><span class="s3">) {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">try</span><span class="s3"> {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">const</span><span class="s3"> combinedContent = filteredEntries.slice(</span><span class="s8">0</span><span class="s3">, </span><span class="s8">10</span><span class="s3">).map(e =&gt; e.content).join(</span><span class="s5">'\n\n'</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">const</span><span class="s3"> themeAnalysis = </span><span class="s2">await</span><span class="s3"> </span><span class="s4">InvokeLLM</span><span class="s3">({</span></p>
<p class="p3"><span class="s6"><span class="Apple-converted-space">          </span>prompt: </span><span class="s3">`Analyze this writing collection and identify the dominant emotional themes. Return the top 6 themes with their relative strength (0-100).</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">          </span></span></p>
<p class="p3"><span class="s3"><span class="Apple-converted-space">          </span>Content: "</span><span class="s6">${combinedContent}</span><span class="s3">"</span></p>
<p class="p7"><span class="s3"><span class="Apple-converted-space">          </span></span></p>
<p class="p3"><span class="s3"><span class="Apple-converted-space">          </span>Focus on emotions like: hope, anxiety, grief, joy, anger, love, fear, peace, confusion, clarity, etc.`</span><span class="s6">,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">          </span>response_json_schema: {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">            </span>type: </span><span class="s5">"object"</span><span class="s3">,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">            </span>properties: {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">              </span>themes: {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                </span>type: </span><span class="s5">"array"</span><span class="s3">,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                </span>items: {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                  </span>type: </span><span class="s5">"object"</span><span class="s3">,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                  </span>properties: {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                    </span>name: { type: </span><span class="s5">"string"</span><span class="s3"> },</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                    </span>strength: { type: </span><span class="s5">"number"</span><span class="s3"> },</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                    </span>color: { type: </span><span class="s5">"string"</span><span class="s3"> }</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                  </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">              </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">          </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s3"><span class="Apple-converted-space">        </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>emotionalThemes = themeAnalysis.themes?.map((theme, index) =&gt; ({</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">          </span>...theme,</span></p>
<p class="p3"><span class="s6"><span class="Apple-converted-space">          </span>color: [</span><span class="s3">'#8B5CF6'</span><span class="s6">, </span><span class="s3">'#F59E0B'</span><span class="s6">, </span><span class="s3">'#EF4444'</span><span class="s6">, </span><span class="s3">'#10B981'</span><span class="s6">, </span><span class="s3">'#3B82F6'</span><span class="s6">, </span><span class="s3">'#EC4899'</span><span class="s6">][index] || </span><span class="s3">'#6B7280'</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>})) || [];</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>} </span><span class="s2">catch</span><span class="s3"> (error) {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>console.error(</span><span class="s5">'Theme analysis failed:'</span><span class="s3">, error);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">    </span></span><span class="s3">// Overall statistics</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> totalWords = filteredEntries.reduce((sum, e) =&gt; sum + (e.word_count || </span><span class="s8">0</span><span class="s3">), </span><span class="s8">0</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> moodImprovements = filteredEntries</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>.filter(e =&gt; e.mood_before &amp;&amp; e.mood_after)</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>.map(e =&gt; e.mood_after - e.mood_before);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> avgMoodImprovement = moodImprovements.length &gt; </span><span class="s8">0</span><span class="s3"><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>? moodImprovements.reduce((a, b) =&gt; a + b, </span><span class="s8">0</span><span class="s3">) / moodImprovements.length<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>: </span><span class="s8">0</span><span class="s3">;</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">    </span></span><span class="s3">// Consistency score (writing frequency)</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> totalDays = </span><span class="s4">Math</span><span class="s3">.ceil((now - startDate) / (</span><span class="s8">1000</span><span class="s3"> * </span><span class="s8">60</span><span class="s3"> * </span><span class="s8">60</span><span class="s3"> * </span><span class="s8">24</span><span class="s3">));</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> writingDays = [...</span><span class="s2">new</span><span class="s3"> </span><span class="s4">Set</span><span class="s3">(filteredEntries.map(e =&gt;<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>format(</span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">(e.created_date), </span><span class="s5">'yyyy-MM-dd'</span><span class="s3">)</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>))].length;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> consistencyScore = </span><span class="s4">Math</span><span class="s3">.round((writingDays / totalDays) * </span><span class="s8">100</span><span class="s3">);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>setProgressData({</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>moodTrend,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>weeklyProgress,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>emotionalThemes,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>overallStats: {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>avgMoodImprovement: </span><span class="s4">Math</span><span class="s3">.round(avgMoodImprovement * </span><span class="s8">10</span><span class="s3">) / </span><span class="s8">10</span><span class="s3">,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>totalWords,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>consistencyScore,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>totalEntries: filteredEntries.length,</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>streakDays: calculateStreak(filteredEntries)</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span>}, [timeRange]);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> loadProgressData = useCallback(</span><span class="s2">async</span><span class="s3"> () =&gt; {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>setIsLoading(</span><span class="s2">true</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">try</span><span class="s3"> {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">const</span><span class="s3"> currentUser = </span><span class="s2">await</span><span class="s3"> </span><span class="s4">User</span><span class="s3">.me();</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>setUser(currentUser);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">if</span><span class="s3"> (currentUser) {</span></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">        </span></span><span class="s3">// Load writing entries</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">const</span><span class="s3"> writingEntries = </span><span class="s2">await</span><span class="s3"> </span><span class="s4">WritingEntry</span><span class="s3">.filter({ created_by: currentUser.email }, </span><span class="s5">'-created_date'</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>setEntries(writingEntries);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">        </span></span><span class="s3">// Load mood entries</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">const</span><span class="s3"> moodData = </span><span class="s2">await</span><span class="s3"> </span><span class="s4">MoodEntry</span><span class="s3">.filter({ created_by: currentUser.email }, </span><span class="s5">'-created_date'</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>setMoodEntries(moodData);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p6"><span class="s6"><span class="Apple-converted-space">        </span></span><span class="s3">// Generate progress analytics</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">await</span><span class="s3"> generateProgressAnalytics(writingEntries, moodData);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>} </span><span class="s2">catch</span><span class="s3"> (error) {</span></p>
<p class="p3"><span class="s6"><span class="Apple-converted-space">      </span>console.error(</span><span class="s3">'Error loading progress data:'</span><span class="s6">, error);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>} </span><span class="s2">finally</span><span class="s3"> {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>setIsLoading(</span><span class="s2">false</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span>}, [generateProgressAnalytics]);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>loadProgressData();</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span>}, [loadProgressData]);</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">const</span><span class="s3"> calculateStreak = (entries) =&gt; {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">if</span><span class="s3"> (entries.length === </span><span class="s8">0</span><span class="s3">) </span><span class="s2">return</span><span class="s3"> </span><span class="s8">0</span><span class="s3">;</span></p>
<p class="p1"><span class="s3"><span class="Apple-converted-space">    </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> dates = [...</span><span class="s2">new</span><span class="s3"> </span><span class="s4">Set</span><span class="s3">(entries.map(e =&gt;<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>format(</span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">(e.created_date), </span><span class="s5">'yyyy-MM-dd'</span><span class="s3">)</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>))].sort().reverse();</span></p>
<p class="p1"><span class="s3"><span class="Apple-converted-space">    </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">let</span><span class="s3"> streak = </span><span class="s8">0</span><span class="s3">;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">const</span><span class="s3"> today = format(</span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">(), </span><span class="s5">'yyyy-MM-dd'</span><span class="s3">);</span></p>
<p class="p1"><span class="s3"><span class="Apple-converted-space">    </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">for</span><span class="s3"> (</span><span class="s2">let</span><span class="s3"> i = </span><span class="s8">0</span><span class="s3">; i &lt; dates.length; i++) {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">const</span><span class="s3"> expectedDate = format(</span><span class="s2">new</span><span class="s3"> </span><span class="s4">Date</span><span class="s3">(</span><span class="s4">Date</span><span class="s3">.now() - i * </span><span class="s8">24</span><span class="s3"> * </span><span class="s8">60</span><span class="s3"> * </span><span class="s8">60</span><span class="s3"> * </span><span class="s8">1000</span><span class="s3">), </span><span class="s5">'yyyy-MM-dd'</span><span class="s3">);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span></span><span class="s2">if</span><span class="s3"> (dates.includes(expectedDate)) {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>streak++;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>} </span><span class="s2">else</span><span class="s3"> {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">break</span><span class="s3">;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s3"><span class="Apple-converted-space">    </span></span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">return</span><span class="s3"> streak;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span></span><span class="s2">if</span><span class="s3"> (isLoading) {</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">return</span><span class="s3"> (</span></p>
<p class="p3"><span class="s6"><span class="Apple-converted-space">      </span>&lt;div className=</span><span class="s3">"min-h-screen flex items-center justify-center"</span><span class="s6">&gt;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>&lt;div className=</span><span class="s5">"text-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s6"><span class="Apple-converted-space">          </span>&lt;</span><span class="s4">Loader2</span><span class="s6"> className=</span><span class="s3">"w-12 h-12 animate-spin mx-auto mb-4 text-rose-500"</span><span class="s6"> /&gt;</span></p>
<p class="p3"><span class="s6"><span class="Apple-converted-space">          </span>&lt;h3 className=</span><span class="s3">"text-xl font-semibold text-gray-800 mb-2"</span><span class="s6">&gt;</span><span class="s4">Analyzing</span><span class="s6"> </span><span class="s4">Your</span><span class="s6"> </span><span class="s4">Journey</span><span class="s6">&lt;/h3&gt;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">          </span>&lt;p className=</span><span class="s5">"text-gray-600"</span><span class="s3">&gt;</span><span class="s4">Creating</span><span class="s3"> your personal progress charts...&lt;/p&gt;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"></span><br></p>
<p class="p1"><span class="s3"><span class="Apple-converted-space"> </span></span></p>
</body>
</html>
